---
title: "rawr package"
author: "Robert Redd"
date: "`r format(Sys.Date(), format = '%d %b %Y')`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

```{r}
library(knitr)
opts_knit$set(eval.after = 'fig.cap', progress = TRUE,  width = 80, 
              verbose = TRUE, par = TRUE)
opts_chunk$set(dev.args = list(antialias = 'none',
                               bg = 'transparent'), 
               dev = 'CairoPNG', dpi = 80, fig.align = 'center',
               warning = TRUE, message = TRUE,
               fig.width = 7, fig.height = 6)
```

<font align = center>

### [graphics](#some-rawr-graphics)

**[joint marginal, box, discrete scatter plots](#special-plots)** <br> **[plotting utilities](#plotting-utils)** <br> **[other gg plots](#other-gg-plots)** | **[survival plots in base and gg](#survival-in-base-and-gg)**

#### more stuff <a href = 'https://github.com/raredd/rgraphics'>here</a>

### [utils](#rawr-utils)

**[utils](#rawr-utils)** | **[stat things](#stat-things)** | **[SAS things](#sas-things)** | **[table/knitr utils](#knitr-utils)** | **[misc utils](#rawr-utils)**

</font>

---


## some rawr graphics

### plots / plot utils

 name           | function
----------------|---------------
`bpCI`          | add error bars/sig stars to barplots
`click.shape`   | add shapes interactively
`click.text`    | add text interactively
`dodge`         | dodge points (alternative to jitter)
`dsplot`        | discrete scatter plot
`facet_adjust`  | ggplot facet adjust
`ggcaterpillar` | caterpillar using ggplot
`ggcols`        | replicate ggplot colors
`ggheat`        | heatmap using ggplot
`ggmultiplot`   | align multiple ggplots on single layout
`ggsurv`        | survival curve using ggplot
`grcols`        | golden ratio colors
`inset`         | inset plots inside plots
`jmplot`        | joint marginal plot
`kmplot`        | survival curve using base
`multiplot`     | plot multiple base plots on single layout
`show.colors`   | show all base colors
`show.pch`      | show all base plotting characters
`tcol`          | add transparency to colors
`tplot`         | improved boxplots


```{r}
library(rawr)
library(ggplot2)
library(grid)
library(gridExtra)
```


## special plots

### joint marginal, box, and discrete scatter plots


```{r}
## jmplot
set.seed(1618)
dat <- data.frame(x = rnorm(100, 20, 5),
                  y = rexp(100),
                  z = c('M','F'),
                  zz = c(LETTERS[1:4]))
dat[1:5, 1:2] <- NA
with(dat, jmplot(x, y, z, type = 'db', jit = .02, col = 1:2, las = 1,
     group.col = TRUE, pch = 1:2, group.pch = TRUE, boxcol = grey(.9),
     cex.n = .8))
```



```{r}
## tplot
set.seed(1618)
dat <- data.frame(age = rnorm(80, rep(c(26, 36), c(70, 10)), 4),
                  sex = sample(c('Female', 'Male'), 80, replace = TRUE),
                  group = paste0('Group ',
                                 sample(1:4, 40, prob = c(2, 5, 4, 1),
                                        replace = TRUE)))
dat[1:5, 'age'] <- NA
tplot(age ~ group, data = dat, las = 1, cex.n = .8, cex.axis = 1, bty = 'L',
      type = c('db', 'db', 'db', 'd'), names = LETTERS[1:4],
      group.pch = TRUE, pch = c(15, 17, 19, 8),
      group.col = FALSE, col = c('darkred', 'darkblue')[c(sex)],
      boxcol = c('lightsteelblue1', 'lightyellow1', grey(.9)),
      boxplot.pars = list(notch = TRUE, boxwex = .5))
```



```{r}
## dsplot
set.seed(1618)
x <- round(rnorm(400, 100, 4))
y <- round(rnorm(400, 200, 4))
sex <- sample(c('Female', 'Male'), 400, replace = TRUE)
dsplot(y ~ x, pch = 19, col = 1 + (sex %in% 'Female'), cex = .6,
       xlab = 'measurement 1', ylab = 'measurement 2', bty = 'L')
legend('bottomright', pch = 19, col = 1:2, bty = 'n',
       legend = c('Male', 'Female'), cex = .8)
```


### plotting utils


```{r}
show.colors()

colors()[259]
```


```{r}
show.pch()
```



```{r}
## transparent colors
cols <- c('orange', 'magenta1', 'lightblue')
plot(rnorm(100), col = tcol(cols, 100), pch = 16, cex = 4, 
     axes = FALSE, xpd = NA, xlab = '', ylab = '')
```



```{r}
## add missing facets for some ggplots

## ?facet_adjust
library(ggplot2)
library(grid)
# missing some labels
(tmp <- ggplot(diamonds[1:100, ], aes(carat, price, colour = clarity)) +
  geom_point() + facet_wrap( ~ cut))
```



```{r}
facet_adjust(tmp)
```



```{r}
set.seed(1618)
dat <- data.frame(x = rpois(50, 1), grp = 1:5)
par(list(mfrow = c(2, 2), mar = c(3,1,2,2)))
with(dat, plot(grp, x, main = 'overlapping points'))
with(dat, plot(grp, x, cex = runif(100), main = 'still overlapping points'))
with(dat, plot(jitter(grp), x, main = 'adding random noise'))
with(dat, plot(grp + dodge(x ~ grp, dat), x, main = 'dodge points'))
```



```{r}
## color functions
layout(matrix(c(1,3,2,3), 2, 2))
par(pch = 19, mar = c(3, 3, 3, 2))
plot(1:10, col = grcols(10), main = "grcols", cex = 6)
plot(1:10, col = ggcols(10), main = "ggcols", cex = 6)
plot(rnorm(100), col = tcol(ggcols(10), 100), main = "tcol", cex = 6)
```


### interactive base plots


```{r, eval=FALSE}
## add shapes or text (and expressions) interactively

?click.shape

?click.text
```


### other gg plots


```{r}
## heat map
tmp <- rescaler(matrix(1:25, 5))
diag(tmp) <- 1
colnames(tmp) <- rownames(tmp) <- LETTERS[1:5]
grobs <- list(ggheat(cors = tmp, limits = c(0, 1)),
              ggheat(cors = tmp, gradn = NULL, gradc = c('white','red')))
(do.call(arrangeGrob, c(grobs, nrow = 1, ncol = 2)))
```



```{r}
## caterpillar plot
library(lme4)
fit <- lmer(Reaction ~ Days + (Days | Subject), data = sleepstudy)
ggcaterpillar(ranef(fit, condVar = TRUE))
```


## survival in base and gg


```{r}
## create kaplan-meier or cox ph plots with base or gg
try_require(survival)
cancer <- within(cancer, {
  age.cat <- factor(as.numeric(cut(age, c(-Inf, 50, 60, 70, Inf))))
})

kmfit <- survfit(Surv(time = time, event = status) ~ sex, data = cancer,
  conf.type = 'log-log')
coxfit <- survfit(coxph(Surv(time = time, event = status) ~ strata(I(age > 45)),
  data = cancer))

## base plots
kmplot(kmfit, col.band = 1:2, strata.lab = c('Male','Female'), mar = c(5,6,1,1))
```


```{r}
## ggplot plots
## ?ggsurv
ggsurv(coxfit, legend.labels = c('< 45','> 45'), legend = FALSE, median = TRUE)
```


---

### sas things

 name        | function
-------------|---------------
`r2sas`      | write/run sas code in r
`get_margs`  | extract macro name(s) and arguments from a text file
`rmacro`     | runs sas macros from .sas files
`sas.mget`   | converts one or more sas data sets to r data frames and returns list
`source_sas` | source-esque function for .sas files


### knitr utils

 name          | function
---------------|---------------
`binconr`      | format exact binomial confidence intervals
`helpExtract`  | extract r help files for use in markdown/sweave documents
`html.test`    | test html code in rstudio viewer
`intr`         | interval formatter
`iprint`       | in-line printing
`pvalr`        | p-value formatter
`Round`        | round numeric vector to sum to a specified target
`roundr`       | improved rounding formatter
`surv_table`   | extract survival summary into table
`tabler`       | extract lm, glm, surv summaries into table
`writeftable`  | convert ftable into (printable) table


### rawr utils

 name         | function
--------------|---------------
`%||%`        | `||` ruby analogue
`%inside%`    | inside interval
`%ni%`        | negation of `%in%`
`bind_all`    | `rbind` or `cbind` objects with unequal rows/columns
`clc`         | remove all objects from workspace
`clear`       | clear console window
`clist`       | concatenate named list
`fapply`      | apply list of functions
`ht`          | head/tail
`ident`       | generalized `identical` function for two or more objects
`interleave`  | interleave vector/matrix/dataframe
`list2file`   | save named list of data frames/matrices to .rda, .csv, etc
`locf`        | last observation carried forward
`lsp`         | list package contents
`lss`         | improved `ls`
`merge2`      | merge two or more data frames
`num2char`    | convert integers to words
`outer2`      | `outer` for n-dimensional arrays
`progress`    | progress percent/text bar
`psum`        | pairwise summation
`recoder`     | recode data frames
`Reload`      | emulate new r session
`rescaler`    | rescale numeric vectors
`search.df`   | search data frames
`search.hist` | search history
`try_require` | load packages silently


```{r}
## list package contents
lsp(rawr, pat = 'plot')
```


```{r}
## search functions for data frames and R history
#? search.hist
df <- within(mtcars, make <- rownames(mtcars))
search.df(110, df, hp)
```


```{r}
search.df("Posch", df, make, var = 1)  # inexact matching
```


```{r}
## data frame, matrix, vector recoder
ht(recoder(mtcars, c(6, 1, 110), NA), sep = "...")
```


```{r}
## more information from ls()
lst <- list()
mat <- matrix(1:9, 3)
lss()
```


## stat things

### utils

 name              | function
-------------------|---------------
`bin1samp`         | one-stage exact binomial designs
`bincon`           | exact binomial confidence intervals
`bintest`          | one-stage exact binomial designs
`dlt.table`        | dlt table  
`local.coxph.test` | local coxph p-value
`match_ctc`        | convert ctc toxicity codes to descriptions
`moods.test`       | mood's median test
`power.cv`         | coefficient of variation power calculation
`simon`            | simon optional two-stage designs  
`simon2`           | simon optional two-stage designs  
`surv_cp`          | convert survival to counting process
`surv_summary`     | extract survival summary into list


```{r}
## binomial confidence interval formatter
list(binconr(5, 10, .90, est = FALSE),
     binconr(45, 53, .95, digits = 1))
```


```{r}
## interval formatter
list(intr(mtcars$mpg), intr(mtcars$mpg, conf = 0.95))
```


```{r}
## rounding formatter
roundr(c(-2e-04, 2e-04, 0.5, -0.5, -0.002), digits = 3)
```


```{r}
## p-value formatter
pvals <- c(0.13354, 0.060123, 0.004233, 1.6223e-07)
pvalr(pvals, digits = 3)
```


```{r}
## simon two-stage designs
simon2(p0 = c(0.55, 0.6), pa = 0.75, ntmax = 45, beta = 0.1)
```


```{r}
## binomial confidence intervals
bincon(0:10, 10)
```


```{r}
## single-stage exact binomial designs
bintest(p0low = 0.2, p1low = 0.5, n.max = 25)
```


```{r}
## coefficient of variation power test
power.cv(n = NULL, f = 1.25, cv = 0.2, sig.level = 0.05, power = 0.8, 
         distribution = "normal")
```

---

<font align = center>

<a href="mailto:raredd01@gmail.com?subject=rawr">talk to me</a>

Most recent compile:

`r format(Sys.Date(), format = '%d %b %Y')` `r R.version.string`

</font>

